<!-- üü£ COMPLETO: agenda.html con formulario modal moderno, checks funcionales, horarios enteros, y sede editable por d√≠a -->
<!-- COMIENZA EL ARCHIVO HTML -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Agenda</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: #cce1d6;
      color: #6d6d6d;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 200px;
      height: 100vh;
      background-color: #91586d;
      padding-top: 60px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      z-index: 1000;
    }

    .sidebar a {
      display: block;
      padding: 10px 16px;
      color: white;
      text-decoration: none;
      font-weight: bold;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 13px;
    }

    .sidebar a:hover {
      background-color: #6d3e4e;
    }

    main {
      margin-left: 200px;
      padding: 16px;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .header img {
      height: 40px;
    }

    h1, h2 {
      color: #91586d;
      margin: 0 0 12px;
      text-align: center;
      font-size: 20px;
    }

    .nav-semana {
      text-align: center;
      margin: 16px 0;
    }

    .nav-semana button {
      background-color: #b48a99;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      margin: 0 8px;
    }

    table.calendario {
      width: 100%;
      max-width: 1100px;
      margin: auto;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.05);
      border-collapse: collapse;
      font-size: 13px;
    }

    th, td {
      padding: 8px 10px;
      border: 1px solid #ccc;
      text-align: center;
      vertical-align: top;
      min-height: 50px;
    }

    th {
      background-color: #b48a99;
      color: white;
    }

    .hora {
      background: #eee;
      font-weight: bold;
      width: 80px;
    }

    .selector-sede-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .selector-sede-container select {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 20px;
      border: 1px solid #aaa;
      background-color: #fff;
    }

    .selector-sede-container button {
      background-color: #91586d;
      color: white;
      border: none;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .selector-sede-container button:hover {
      background-color: #6d3e4e;
    }

    /* MODAL flotante para Registrar Clase */
    #formularioClase {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.4);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }

    #formularioClase .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      position: relative;
    }

    #formularioClase .modal-content input,
    #formularioClase .modal-content select {
      width: 100%;
      margin-bottom: 10px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    #formularioClase .modal-content button {
      background-color: #b48a99;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    #formularioClase .modal-content button:hover {
      background-color: #91586d;
    }

    #formularioClase .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
        width: 100%;
        height: auto;
        position: absolute;
        top: 50px;
        left: 0;
      }

      .sidebar.mostrar {
        display: block;
      }

      #menuToggle {
        display: block;
        position: fixed;
        top: 10px;
        left: 10px;
        background-color: #91586d;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 12px;
        font-size: 18px;
        cursor: pointer;
        z-index: 1100;
      }

      main {
        margin-left: 0;
        padding: 20px;
      }

      .header {
        flex-direction: column;
      }

      table.calendario {
        font-size: 11px;
      }

      .selector-sede-container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
<button id="menuToggle" onclick="toggleMenu()">‚ò∞</button>
<div class="sidebar">
  <a href="index.html">üìã Alumnas/os</a>
  <a href="pagos.html">üí≥ Pagos</a>
  <a href="gastos.html">üßæ Gastos</a>
  <a href="agenda.html">üìÖ Agenda</a>
  <a href="configuracion.html">‚öôÔ∏è Configuraci√≥n</a>
  <a href="reportes.html">üìà Reportes</a>
  <button onclick="cerrarSesion()" style="width: 100%; text-align: left; padding: 10px 16px; background-color: transparent; border: none; color: white; font-weight: bold; font-size: 13px; cursor: pointer; border-top: 1px solid rgba(255,255,255,0.1);">
    üö™ Cerrar sesi√≥n
  </button>
</div>
<main>
  <div class="header">
    <img src="logo.jpeg" alt="Logo">
    <h1>Agenda Semanal Etnya</h1>
  </div>

  <div class="selector-sede-container">
    <label for="selectorSede">Seleccionar sede:</label>
    <select id="selectorSede" onchange="renderizarAgenda()">
      <option value="craig_reformer">Craig Reformer</option>
      <option value="craig_circuito">Craig Circuito</option>
      <option value="goyena">Pedro Goyena</option>
    </select>
    <button onclick="mostrarFormulario()">‚ûï Registrar Clase</button>
  </div>

  <div class="nav-semana">
    <button onclick="cambiarSemana(-1)">‚óÑ Semana anterior</button>
    <span id="tituloSemana">Semana actual</span>
    <button onclick="cambiarSemana(1)">Semana siguiente ‚ñ∫</button>
  </div>

  <table class="calendario" id="tablaAgenda">  
    <thead id="theadAgenda"></thead>
    <tbody id="tbodyAgenda"></tbody>
  </table>

  <div id="formularioClase" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); z-index: 9999; justify-content: center; align-items: center;">
  <div class="modal-content">
    <h2 style="text-align:center; color:#91586d;">Registrar Clase</h2>
    <button onclick="cerrarFormulario()" class="close-btn">‚úñ</button>

    <input type="text" id="busquedaAlumno" placeholder="Buscar alumno..." oninput="buscarAlumno()">
    <select id="alumnoSeleccionado"></select>

    <label><input type="checkbox" id="esPrueba" onchange="alternarUnica()"> Clase de Prueba</label>
    <label><input type="checkbox" id="esUnica" onchange="alternarUnica()"> Clase por √∫nica vez</label>

    <div id="formRecurrente">
      <label>Sede:</label>
      <select id="sedeRecurrente" onchange="actualizarSedesPorDia()">
        <option value="Craig Reformer">Craig Reformer</option>
        <option value="Craig Circuito">Craig Circuito</option>
        <option value="Pedro Goyena">Pedro Goyena</option>
      </select>

      <div id="diasSemana">
        <label>Lunes:
          <select id="hora-Lunes"></select>
          <select id="sede-Lunes"></select>
        </label><br>
        <label>Martes:
          <select id="hora-Martes"></select>
          <select id="sede-Martes"></select>
        </label><br>
        <label>Mi√©rcoles:
          <select id="hora-Mi√©rcoles"></select>
          <select id="sede-Mi√©rcoles"></select>
        </label><br>
        <label>Jueves:
          <select id="hora-Jueves"></select>
          <select id="sede-Jueves"></select>
        </label><br>
        <label>Viernes:
          <select id="hora-Viernes"></select>
          <select id="sede-Viernes"></select>
        </label><br>
        <label id="campoSabado" style="display: none;">S√°bado:
          <select id="hora-S√°bado"></select>
          <select id="sede-S√°bado"></select>
        </label>
      </div>
    </div>

    <div id="formUnica" style="display:none;">
      <label>Fecha exacta:</label>
      <input type="date" id="fechaUnica">
      <label>Horario:</label>
      <select id="horaUnica"></select>
      <label>Sede:</label>
      <select id="sedeUnica">
        <option value="Craig Reformer">Craig Reformer</option>
        <option value="Craig Circuito">Craig Circuito</option>
        <option value="Pedro Goyena">Pedro Goyena</option>
      </select>
    </div>

    <button onclick="guardarClase()">Guardar Clase</button>
  </div>
</div>

<script>
function mostrarFormulario() {
  document.getElementById('formularioClase').style.display = 'flex';
  armarSelectsHorarioYsedes();
}

function cerrarFormulario() {
  document.getElementById('formularioClase').style.display = 'none';
}

function alternarUnica() {
  const esUnica = document.getElementById('esUnica').checked || document.getElementById('esPrueba').checked;
  document.getElementById('formRecurrente').style.display = esUnica ? 'none' : 'block';
  document.getElementById('formUnica').style.display = esUnica ? 'block' : 'none';
}

function actualizarSedesPorDia() {
  const sede = document.getElementById('sedeRecurrente').value;
  const dias = ['Lunes','Martes','Mi√©rcoles','Jueves','Viernes','S√°bado'];
  dias.forEach(dia => {
    const select = document.getElementById(`sede-${dia}`);
    if (select) select.value = sede;
  });
}

function armarSelectsHorarioYsedes() {
  const horas = Array.from({ length: 14 }, (_, i) => `${(8 + i).toString().padStart(2, '0')}:00`);
  const dias = ['Lunes','Martes','Mi√©rcoles','Jueves','Viernes','S√°bado'];

  dias.forEach(dia => {
    const horaSel = document.getElementById(`hora-${dia}`);
    const sedeSel = document.getElementById(`sede-${dia}`);
    if (horaSel) {
      horaSel.innerHTML = horas.map(h => `<option value="${h}">${h}</option>`).join('');
    }
    if (sedeSel) {
      sedeSel.innerHTML = `
        <option value="Craig Reformer">Craig Reformer</option>
        <option value="Craig Circuito">Craig Circuito</option>
        <option value="Pedro Goyena">Pedro Goyena</option>
      `;
    }
  });

  const horaUnica = document.getElementById('horaUnica');
  if (horaUnica) horaUnica.innerHTML = horas.map(h => `<option value="${h}">${h}</option>`).join('');
}

const sedeRecurrenteSelect = document.getElementById('sedeRecurrente');
sedeRecurrenteSelect.addEventListener('change', () => {
  const mostrar = sedeRecurrenteSelect.value === 'Pedro Goyena';
  document.getElementById('campoSabado').style.display = mostrar ? 'block' : 'none';
});

async function buscarAlumno() {
  const texto = document.getElementById('busquedaAlumno').value.trim();
  if (texto.length < 2) return;
  try {
    const res = await fetch(`/alumnos/buscar?q=${encodeURIComponent(texto)}`);
    const alumnos = await res.json();
    const select = document.getElementById('alumnoSeleccionado');
    select.innerHTML = '';
    alumnos.forEach(a => {
      const opt = document.createElement('option');
      opt.value = a.id;
      opt.textContent = `${a.nombre} - N¬∞${a.numero_alumno}`;
      select.appendChild(opt);
    });
  } catch (err) {
    console.error('Error al buscar alumno:', err);
  }
}

window.onload = () => {
  renderizarAgenda();
};

</script>
</body>
</html>