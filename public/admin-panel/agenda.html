<!-- ACTUALIZADO: Agenda con dise√±o de configuraci√≥n.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Agenda</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: #cce1d6;
      color: #6d6d6d;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 200px;
      height: 100vh;
      background-color: #91586d;
      padding-top: 60px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      z-index: 1000;
    }

    .sidebar a {
      display: block;
      padding: 10px 16px;
      color: white;
      text-decoration: none;
      font-weight: bold;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 13px;
    }

    .sidebar a:hover {
      background-color: #6d3e4e;
    }

    main {
      margin-left: 200px;
      padding: 16px;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .header img {
      height: 40px;
    }

    h1, h2 {
      color: #91586d;
      margin: 0 0 12px;
      text-align: center;
      font-size: 20px;
    }

    .nav-semana {
      text-align: center;
      margin: 16px 0;
    }

    .nav-semana button {
      background-color: #b48a99;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      margin: 0 8px;
    }

    table.calendario {
      width: 100%;
      max-width: 1100px;
      margin: auto;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.05);
      border-collapse: collapse;
      font-size: 13px;
    }

    th, td {
      padding: 8px 10px;
      border: 1px solid #ccc;
      text-align: center;
      vertical-align: top;
      min-height: 50px;
    }

    th {
      background-color: #b48a99;
      color: white;
    }

    .hora {
      background: #eee;
      font-weight: bold;
      width: 80px;
    }

    /* NUEVO MODAL flotante */
#formularioClase {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

#formularioClase .modal-content {
  background-color: #fff;
  padding: 20px 24px;
  border-radius: 12px;
  max-width: 480px;
  width: 90%;
  box-shadow: 0 5px 20px rgba(0,0,0,0.2);
  font-size: 14px;
  color: #6d6d6d;
  max-height: 90vh;
  overflow-y: auto;
}

#formularioClase h2 {
  text-align: center;
  margin-top: 0;
  margin-bottom: 20px;
  font-size: 20px;
  color: #91586d;
}

#formularioClase input,
#formularioClase select {
  width: 100%;
  padding: 6px 10px;
  font-size: 13px;
  border: 1px solid #ccc;
  border-radius: 6px;
  margin-bottom: 12px;
}

#formularioClase label {
  display: block;
  margin-bottom: 6px;
  font-weight: 500;
  font-size: 13px;
}

#formularioClase button {
  background-color: #91586d;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
  margin-top: 12px;
  margin-right: 10px;
}

#formularioClase button:hover {
  background-color: #6d3e4e;
}

.modal-content h2 {
  color: #91586d;
  text-align: center;
  margin-bottom: 16px;
}

.modal-content input,
.modal-content select {
  width: 100%;
  padding: 8px;
  margin-bottom: 12px;
  border-radius: 5px;
  border: 1px solid #94b8a3;
  font-size: 13px;
  background-color: #f9f9f9;
}

.modal-content label {
  font-weight: 600;
  display: block;
  margin-top: 10px;
  margin-bottom: 4px;
}

.modal-content button {
  background-color: #91586d;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 5px;
  font-size: 13px;
  cursor: pointer;
  margin-right: 10px;
}

.modal-content button:hover {
  background-color: #6d3e4e;
}


    .formulario-clase input,
    .formulario-clase select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #94b8a3;
      font-size: 13px;
      background-color: #f9f9f9;
    }

    .formulario-clase button {
      background-color: #b48a99;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
      margin-right: 8px;
    }

    .formulario-clase button:hover {
      background-color: #91586d;
    }

    #menuToggle {
      display: none;
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1100;
      background-color: #91586d;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 18px;
      cursor: pointer;
    }

    .selector-sede-container {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .selector-sede-container select {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 20px;
      border: 1px solid #aaa;
      background-color: #fff;
    }

    .selector-sede-container button {
      background-color: #91586d;
      color: white;
      border: none;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .selector-sede-container button:hover {
      background-color: #6d3e4e;
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
        width: 100%;
        height: auto;
        position: absolute;
        top: 50px;
        left: 0;
      }

      .sidebar.mostrar {
        display: block;
      }

      #menuToggle {
        display: block;
      }

      main {
        margin-left: 0;
        padding: 20px;
      }

      .header {
        flex-direction: column;
      }

      table.calendario {
        font-size: 11px;
      }

      .selector-sede-container {
        flex-direction: column;
      }
    }


.checkbox-contenedor {
  display: flex;
  justify-content: flex-start;
  gap: 30px;
  margin: 15px 0;
}

.checkbox-contenedor label {
  display: flex;
  align-items: center;
  font-size: 14px;
  color: #6d6d6d;
  gap: 6px;
}


  </style>
</head>
<body>
<!-- Bot√≥n men√∫ hamburguesa -->
<button id="menuToggle" onclick="toggleMenu()">‚ò∞</button>
<!-- Sidebar -->
<div class="sidebar">
  <a href="index.html">üìã Alumnas/os</a>
  <a href="pagos.html">üí≥ Pagos</a>
  <a href="gastos.html">üßæ Gastos</a>
  <a href="agenda.html">üìÖ Agenda</a>
  <a href="configuracion.html">‚öôÔ∏è Configuraci√≥n</a>
  <a href="reportes.html">üìà Reportes</a>
  <button onclick="cerrarSesion()" style="width: 100%; text-align: left; padding: 10px 16px; background-color: transparent; border: none; color: white; font-weight: bold; font-size: 13px; cursor: pointer; border-top: 1px solid rgba(255,255,255,0.1);">
    üö™ Cerrar sesi√≥n
  </button>
</div>
<main>
  <div class="header">
    <img src="logo.jpeg" alt="Logo">
    <h1>Agenda Semanal Etnya</h1>
  </div>

  <div class="selector-sede-container">
    <label for="selectorSede">Seleccionar sede:</label>
    <select id="selectorSede" onchange="renderizarAgenda()">
      <option value="craig_reformer">Craig Reformer</option>
      <option value="craig_circuito">Craig Circuito</option>
      <option value="goyena">Pedro Goyena</option>
    </select>
    <button onclick="mostrarFormulario()">‚ûï Registrar Clase</button>
  </div>


  <div class="nav-semana">
    <button onclick="cambiarSemana(-1)">‚óÑ Semana anterior</button>
    <span id="tituloSemana">Semana actual</span>
    <button onclick="cambiarSemana(1)">Semana siguiente ‚ñ∫</button>
  </div>

  <table class="calendario" id="tablaAgenda">	
    <thead id="theadAgenda"></thead>
    <tbody id="tbodyAgenda"></tbody>
  </table>

 <!-- Modal: contenedor general -->
<div id="formularioClase">
  <!-- Contenido centrado del modal -->
  <div class="modal-content">
    <h2>Registrar Clase</h2>

    <input type="text" id="busquedaAlumno" placeholder="Buscar alumno...">
    <select id="alumnoSeleccionado"></select>

   <div style="display: flex; justify-content: center; gap: 40px; margin-bottom: 15px;">
  <label style="display: flex; align-items: center; gap: 6px;">
    <input type="checkbox" id="esPrueba">
    Clase de Prueba
  </label>
  <label style="display: flex; align-items: center; gap: 6px;">
    <input type="checkbox" id="esUnica" onchange="alternarUnica()">
    Clase por √∫nica vez
  </label>
</div>





    <div id="formRecurrente">
      <label>Sede:</label>
      <select id="sedeRecurrente">
        <option value="Craig Reformer">Craig Reformer</option>
        <option value="Craig Circuito">Craig Circuito</option>
        <option value="Pedro Goyena">Pedro Goyena</option>
      </select>

      <div id="diasSemana">
        <label>Lunes: <input type="time" id="hora-Lunes" step="3600"></label>
        <label>Martes: <input type="time" id="hora-Martes" step="3600"></label>
        <label>Mi√©rcoles: <input type="time" id="hora-Mi√©rcoles" step="3600"></label>
        <label>Jueves: <input type="time" id="hora-Jueves" step="3600"></label>
        <label>Viernes: <input type="time" id="hora-Viernes" step="3600"></label>
        <label id="campoSabado">S√°bado: <input type="time" id="hora-S√°bado" step="3600"></label>
      </div>
    </div>

    <div id="formClaseUnica" style="display: none;">
  <label>Fecha exacta:</label>
  <input type="date" id="fechaUnica">

  <label>Horario:</label>
<select id="horaUnica">
  <option value="08:00">08:00</option>
  <option value="09:00">09:00</option>
  <option value="10:00">10:00</option>
  <option value="11:00">11:00</option>
  <option value="12:00">12:00</option>
  <option value="13:00">13:00</option>
  <option value="14:00">14:00</option>
  <option value="15:00">15:00</option>
  <option value="16:00">16:00</option>
  <option value="17:00">17:00</option>
  <option value="18:00">18:00</option>
  <option value="19:00">19:00</option>
  <option value="20:00">20:00</option>
</select>


  <label>Sede:</label>
<select id="sedeUnica">
  <option value="Craig Reformer">Craig Reformer</option>
  <option value="Craig Circuito">Craig Circuito</option>
  <option value="Pedro Goyena">Pedro Goyena</option>
</select>
</div> <!-- üîß Cierra correctamente el div de formClaseUnica -->

<!-- FORMULARIO: Clase de prueba -->
<div id="formClasePrueba" style="display: none;">
  <label>Nombre del alumna/o:</label>
  <input type="text" id="nombreClasePrueba" placeholder="Ej: Invitaci√≥n especial">

  <label>Fecha:</label>
  <input type="date" id="fechaPrueba">

  <label>Hora:</label>
  <select id="horaPrueba">
    <option value="08:00">08:00</option>
    <option value="09:00">09:00</option>
    <option value="10:00">10:00</option>
    <option value="11:00">11:00</option>
    <option value="12:00">12:00</option>
    <option value="13:00">13:00</option>
    <option value="14:00">14:00</option>
    <option value="15:00">15:00</option>
    <option value="16:00">16:00</option>
    <option value="17:00">17:00</option>
    <option value="18:00">18:00</option>
    <option value="19:00">19:00</option>
    <option value="20:00">20:00</option>
  </select>

  <label>Sede:</label>
  <select id="sedePrueba">
    <option value="Craig Reformer">Craig Reformer</option>
    <option value="Craig Circuito">Craig Circuito</option>
    <option value="Pedro Goyena">Pedro Goyena</option>
  </select>
</div>

<!-- üîΩ Botones de acci√≥n (fuera de los formularios) -->
<div style="text-align: right; margin-top: 20px;">
  <button onclick="guardarClase()">Guardar Clase</button>
  <button onclick="cerrarFormulario()">Cancelar</button>
</div>



<script>
let semanaOffset = 0;

function cambiarSemana(d) {
  semanaOffset += d;
  renderizarAgenda();
}

async function renderizarAgenda() {
  const sede = document.getElementById('selectorSede').value;
  const hoy = new Date();
  hoy.setDate(hoy.getDate() + semanaOffset * 7);
  const dia = hoy.getDay();
  const lunes = new Date(hoy);
  lunes.setDate(hoy.getDate() - ((dia + 6) % 7));

  const dias = sede === 'goyena'
    ? ['Lunes','Martes','Mi√©rcoles','Jueves','Viernes','S√°bado']
    : ['Lunes','Martes','Mi√©rcoles','Jueves','Viernes'];

  const horas = sede === 'goyena'
    ? Array.from({length: 14}, (_, i) => `${(8 + i).toString().padStart(2,'0')}:00`)
    : Array.from({length: 12}, (_, i) => `${(9 + i).toString().padStart(2,'0')}:00`);

  const thead = document.getElementById('theadAgenda');
  const tbody = document.getElementById('tbodyAgenda');
  thead.innerHTML = '';
  tbody.innerHTML = '';



  // encabezado con mes y a√±o
  const fechaStr = lunes.toLocaleDateString('es-AR', { month: 'long', year: 'numeric' });
  document.getElementById('tituloSemana').innerText = `${fechaStr.charAt(0).toUpperCase() + fechaStr.slice(1)}`;

  const encabezadoDias = dias.map((d, i) => {
    const f = new Date(lunes);
    f.setDate(lunes.getDate() + i);
    return `<th>${d} ${f.getDate()}</th>`;
  }).join('');

  thead.innerHTML = `<tr><th class='hora'>Hora</th>${encabezadoDias}</tr>`;

  const filas = horas.map(h => [`<td class='hora'>${h}</td>`].concat(dias.map(() => '<td></td>')));
  for (let fila of filas) tbody.innerHTML += `<tr>${fila.join('')}</tr>`;

  // cargar clases desde backend
  const desde = new Date(lunes);
  const hasta = new Date(lunes);
  hasta.setDate(hasta.getDate() + dias.length - 1);

  const desdeStr = desde.toISOString().split('T')[0];
  const hastaStr = hasta.toISOString().split('T')[0];

  try {
    const res = await fetch(`/clases?desde=${desdeStr}&hasta=${hastaStr}`);
    const clases = await res.json();

    clases.filter(c => c.sede.toLowerCase().includes(sede.replace('_',' '))).forEach(clase => {
      const fecha = new Date(clase.fecha);
      const hora = clase.hora.slice(0, 5);
      const diaSemana = (fecha.getDay() + 6) % 7; // lunes = 0
      if (diaSemana >= dias.length) return;

      const fila = Array.from(tbody.querySelectorAll('tr')).find(tr => tr.children[0].textContent === hora);
      if (!fila) return;

   
      const celda = fila.children[diaSemana + 1];
      celda.innerHTML += `<div>${clase.nombre} - N¬∞${clase.numero_alumno}</div>`;
    });

  } catch (err) {
    console.error('Error al cargar clases:', err);
  }
}

function mostrarFormulario() {
  document.getElementById('formularioClase').style.display = 'flex';
}
function cerrarFormulario() {
  document.getElementById('formularioClase').style.display = 'none';
}
function alternarUnica() {
  const esUnica = document.getElementById('esUnica').checked;
  const esPrueba = document.getElementById('esPrueba').checked;

  // Mostrar/ocultar formularios seg√∫n checkboxes
  document.getElementById('formRecurrente').style.display = (!esUnica && !esPrueba) ? 'block' : 'none';
  document.getElementById('formClaseUnica').style.display = esUnica ? 'block' : 'none';
  document.getElementById('formClasePrueba').style.display = esPrueba ? 'block' : 'none';

  // Mostrar/ocultar campos de alumno (solo para clase por √∫nica vez)
  document.getElementById('busquedaAlumno').style.display = esUnica ? 'block' : 'none';
  document.getElementById('alumnoSeleccionado').style.display = esUnica ? 'block' : 'none';
}

 
// Mostrar u ocultar el campo de S√°bado seg√∫n la sede seleccionada
const sedeRecurrenteSelect = document.getElementById('sedeRecurrente');
sedeRecurrenteSelect.addEventListener('change', () => {
  const mostrar = sedeRecurrenteSelect.value === 'Pedro Goyena';
  document.getElementById('campoSabado').style.display = mostrar ? 'block' : 'none';
});

// ‚úÖ NUEVO: cargar alumnos en el formulario
async function cargarAlumnos() {
  try {
    const res = await fetch('/alumnos');
    const alumnos = await res.json();

    const select = document.getElementById('alumnoSeleccionado');
    select.innerHTML = '';
    alumnos.forEach(alumno => {
      const option = document.createElement('option');
      option.value = alumno.id;
      option.textContent = `${alumno.apellido}, ${alumno.nombre} - N¬∞${alumno.numero_alumno}`;
      select.appendChild(option);
    });
  } catch (err) {
    console.error('Error al cargar alumnos:', err);
  }
}

// ‚úÖ Modificado: mostrar formulario y cargar alumnos
function mostrarFormulario() {
  document.getElementById('formularioClase').style.display = 'flex';
  cargarAlumnos();
  alternarUnica(); // ‚úÖ Esto faltaba
}

<script>
function guardarClase() {
  const esUnica = document.getElementById('esUnica').checked;
  const esPrueba = document.getElementById('esPrueba').checked;

  if (esUnica) {
    const alumnoId = document.getElementById('alumnoSeleccionado').value;
    const fecha = document.getElementById('fechaUnica').value;
    const hora = document.getElementById('horaUnica').value;
    const sede = document.getElementById('sedeUnica').value;

    if (!alumnoId || !fecha || !hora || !sede) {
      alert("Complet√° todos los campos para clase √∫nica.");
      return;
    }

    const clase = {
      alumno_id: alumnoId,
      clases: [{ fecha, hora, sede }]
    };

    fetch('/clases', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(clase)
    })
    .then(res => {
      if (!res.ok) throw new Error('Error al guardar');
      return res.json();
    })
    .then(() => {
      alert('Clase guardada');
      cerrarFormulario();
      renderizarAgenda();
    })
    .catch(err => {
      console.error(err);
      alert('Hubo un error al guardar la clase');
    });
  }

  else if (esPrueba) {
    const nombre = document.getElementById('nombreClasePrueba').value;
    const fecha = document.getElementById('fechaPrueba').value;
    const hora = document.getElementById('horaPrueba').value;
    const sede = document.getElementById('sedePrueba').value;

    if (!nombre || !fecha || !hora || !sede) {
      alert("Complet√° todos los campos para clase de prueba.");
      return;
    }

    const clase = {
      alumno_id: null,
      clases: [{
        fecha,
        hora,
        sede,
        nombre: nombre.trim()
      }]
    };

    fetch('/clases', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(clase)
    })
    .then(res => {
      if (!res.ok) throw new Error('Error al guardar clase de prueba');
      return res.json();
    })
    .then(() => {
      alert('Clase de prueba guardada');
      cerrarFormulario();
      renderizarAgenda();
    })
    .catch(err => {
      console.error(err);
      alert('Hubo un error al guardar la clase de prueba');
    });
  }

  else {
    alert("Seleccion√° una opci√≥n: clase √∫nica o clase de prueba.");
  }
}
</script>


renderizarAgenda();

document.getElementById('busquedaAlumno').addEventListener('input', function() {
  const texto = this.value.toLowerCase();
  const select = document.getElementById('alumnoSeleccionado');

  for (const option of select.options) {
    const nombre = option.textContent.toLowerCase();
    option.style.display = nombre.includes(texto) ? '' : 'none';
  }
});

document.getElementById('esPrueba').addEventListener('change', alternarUnica);
document.getElementById('esUnica').addEventListener('change', alternarUnica);



</script>
</body>
</html>