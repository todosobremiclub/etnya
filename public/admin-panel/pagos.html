<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pagos - Etnya</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: #cce1d6;
      color: #6d6d6d;
    }
    #menuToggle {
      display: none;
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1100;
      background-color: #91586d;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 18px;
      cursor: pointer;
    }
    main {
      margin-left: 200px;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      color: #91586d;
    }
    .formulario {
      max-width: 600px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.1);
      position: relative;
    }
    .formulario input, .formulario select {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .formulario label {
      font-weight: bold;
    }
    .formulario .boton-guardar {
      background-color: #91586d;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      margin-top: 10px;
    }
    .formulario .boton-guardar:hover {
      background-color: #6d3e4e;
    }
    .formulario .cerrar {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 20px;
      color: #91586d;
      cursor: pointer;
    }
    table {
      width: 100%;
      max-width: 900px;
      margin: 30px auto;
      background: white;
      border-collapse: collapse;
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
      border-radius: 8px;
      overflow: hidden;
      font-size: 14px;
    }
    th, td {
      padding: 10px;
      border-bottom: 1px solid #eee;
      text-align: left;
    }
    th {
      background-color: #b48a99;
      color: white;
    }
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 200px;
      height: 100vh;
      background-color: #91586d;
      padding-top: 60px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      z-index: 1000;
    }
    .sidebar a {
      display: block;
      padding: 10px 16px;
      color: white;
      text-decoration: none;
      font-weight: bold;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 13px;
    }
    .sidebar a:hover {
      background-color: #6d3e4e;
    }
    @media (max-width: 768px) {
      #menuToggle {
        display: block;
      }
      .sidebar {
        display: none;
        width: 100%;
        height: auto;
        position: absolute;
        top: 50px;
        left: 0;
      }
      .sidebar.mostrar {
        display: block;
      }
      main {
        margin-left: 0;
        padding: 20px;
      }
      .formulario {
        width: 90%;
      }
    }
    .select2-container--default .select2-selection--single {
      height: 36px;
      font-size: 14px;
      border-radius: 6px;
    }
    .select2-container .select2-dropdown {
      font-size: 13px;
    }

input[type="month"].fake-placeholder:invalid::-webkit-datetime-edit {
  color: transparent;
}

input[type="month"].fake-placeholder:invalid:before {
  content: "Seleccionar mes";
  color: #999;
  position: absolute;
  font-size: 14px;
}

  </style>
</head>


<body>

<div style="margin-left: 200px;">
  <div style="
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px 0;
    transform: translateX(-10px);
  ">
    <img src="logo.jpeg" alt="Logo" style="height: 60px; margin-right: 16px;">
    <h2 style="margin: 0; font-size: 28px; color: #91586d;">Pagos Etnya</h2>
  </div>
</div>




<button id="menuToggle" onclick="toggleMenu()">‚ò∞</button>


 <!-- Sidebar -->
  <div class="sidebar">
    <a href="index.html">üìã Alumnas/os</a>
    <a href="pagos.html">üí≥ Pagos</a>
    <a href="gastos.html"   class="menu-gastos">üßæ Gastos</a>
    <a href="agenda.html">üìÖ Agenda</a>
    <a href="configuracion.html">‚öôÔ∏è Configuraci√≥n</a>
    <a href="reportes.html" class="menu-reportes">üìà Reportes</a>
    <button onclick="cerrarSesion()" style="width: 100%; text-align: left; padding: 10px 16px; background-color: transparent; border: none; color: white; font-weight: bold; font-size: 13px; cursor: pointer; border-top: 1px solid rgba(255,255,255,0.1);">
      üö™ Cerrar sesi√≥n
    </button>
  </div>


  <main>
<div style="text-align: center; margin-bottom: 20px;">
  <button onclick="mostrarFormularioPago()" style="
    padding: 10px 20px;
    background-color: #91586d;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
  ">‚ûï Registrar Pago</button>
</div>

  <!-- FORMULARIO BLANCO -->
  <div class="formulario" id="formularioPago" style="display: none;">
    <button class="cerrar" onclick="cerrarFormularioPago()">‚úñ</button>
    <label for="alumno-select">Buscar y seleccionar alumno:</label>
    <select id="alumno-select" style="width: 100%"></select>

    <label for="mesPago">Mes a pagar:</label>
    <input type="month" id="mesPago" required class="fake-placeholder">


    <label for="modalidad">Modalidad:</label>
    <input type="text" id="modalidad" disabled>

    <label for="monto">Monto:</label>
    <input type="number" id="monto" disabled>

<label for="cuenta">Cuenta:</label>
<select id="cuenta" name="cuenta">
  <option value="">Seleccionar cuenta</option>
</select>


    <!-- Checkbox Pago parcial -->
    <div style="display: flex; justify-content: flex-end; margin-top: 10px;">
      <label for="parcial" style="display: flex; align-items: center; font-size: 14px; gap: 6px; cursor: pointer;">
        <input type="checkbox" id="parcial" style="margin: 0;">
        Pago parcial
      </label>
    </div>

    <!-- Campo oculto para monto manual -->
    <!-- Campo oculto para monto manual -->
<div id="grupoMontoManual" style="display: none;">
  <label for="montoParcial">Monto manual:</label>
  <input type="number" id="montoParcial" disabled>
</div>

<!-- Grupo especial para Pagos de clases de prueba -->
<div id="grupoPrueba" style="display:none; margin-top:10px;">
  <label for="comentarioPrueba">Comentario:</label>
  <textarea id="comentarioPrueba" rows="3" placeholder="Escrib√≠ un comentario (opcional)"></textarea>

  <label for="montoFijo">Monto fijo (en $):</label>
  <input type="number" id="montoFijo" min="0" step="1" placeholder="0">

  <label for="sedePrueba">Sede:</label>
  <select id="sedePrueba">
    <option value="">Seleccion√° sede</option>
    <option value="Craig Reformer">Craig Reformer</option>
    <option value="Craig Circuito">Craig Circuito</option>
    <option value="Pedro Goyena">Pedro Goyena</option>
  </select>
</div>


<!-- Bot√≥n Guardar ahora dentro del formulario -->
<div style="text-align: center; margin-top: 20px;">
  <button onclick="guardarPago()" style="
    background-color: #91586d;
    color: white;
    border: none;
    padding: 12px 24px;
    font-size: 16px;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  ">üíæ Guardar Pago</button>
</div>

  </div> <!-- fin del formulario blanco -->

  
  </div>

  <!-- M√ìDULO PAGOS REGISTRADOS -->
  <h2 style="margin-top: 40px;">Pagos Registrados</h2>

  <div style="max-width: 400px; margin: 0 auto 10px auto;">
    <input type="text" id="buscadorPagos" placeholder="Buscar por n√∫mero, apellido o nombre"
      style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc;">
  </div>

  <table>
    <thead>
      <tr>
        <th>N¬∞ Alumno</th>
        <th>Nombre</th>
        <th>Modalidad</th>
        <th>Mes Pagado</th>
        <th>Monto</th>
        <th>Fecha de Pago</th>
<th>Cuenta</th>

      </tr>
    </thead>
    <tbody id="tbodyPagos"></tbody>
  </table>

</main>

<script>
  (function () {
    // 1) Forzar login
    if (localStorage.getItem('etnya_login') !== 'ok') {
      location = 'login.html';
      return;
    }

    // 2) Rol del usuario
    const rol = localStorage.getItem('etnya_role') || '';

    // 3) Ocultar men√∫ si no es admin (sin alert)
    if (rol !== 'admin') {
      document.querySelectorAll('.menu-reportes, .menu-gastos')
        .forEach(el => el.style.display = 'none');
    }

    // 4) Bloqueo silencioso de p√°ginas restringidas (sin alert)
    const restricted = { 'reportes.html': 'admin', 'gastos.html': 'admin' };
    const page = (location.pathname.split('/').pop() || '').toLowerCase();
    if (restricted[page] && rol !== restricted[page]) {
      location = 'index.html';
    }
  })();
</script>


<script>
/* ====== Constantes / estado ====== */
const OPT_PRUEBA_VALUE = 'PRUEBA_SPECIAL';
const alumnos = [];
let tiposClase = [];
let pagosGlobal = [];

/* ====== Util ====== */
function normalizarTexto(texto) {
  return (texto || '').toLowerCase().trim().replace(/\s+/g, ' ');
}

/* ====== UI: monto parcial ====== */
document.getElementById("parcial").addEventListener("change", (e) => {
  const grupo = document.getElementById("grupoMontoManual");
  const montoParcial = document.getElementById("montoParcial");
  grupo.style.display = e.target.checked ? 'block' : 'none';
  montoParcial.disabled = !e.target.checked;
});

/* ====== Select2 ====== */
$(document).ready(() => {
  $('#alumno-select').select2({
    placeholder: "Seleccionar alumno",
    width: '100%'
  });
});

/* ====== Cargar cuentas ====== */
async function cargarCuentas() {
  try {
    const res = await fetch('/cuentas');
    const cuentas = await res.json();
    const select = document.getElementById('cuenta');
    select.innerHTML = '<option value="">Seleccionar cuenta</option>';
    cuentas.forEach(c => {
      const option = document.createElement('option');
      option.value = c.nombre;
      option.textContent = c.nombre;
      select.appendChild(option);
    });
  } catch (err) {
    console.error('Error al cargar cuentas:', err);
  }
}

/* ====== ONLOAD ====== */
window.onload = async () => {
  // Seguridad (ya la ten√©s arriba, pero lo dejamos por si este script se mueve)
  if (localStorage.getItem('etnya_login') !== 'ok') {
    window.location.href = 'login.html';
    return;
  }

  // 1) Datos base
  const resAlumnos = await fetch('/alumnos');
  const dataAlumnos = await resAlumnos.json();
  alumnos.splice(0, alumnos.length, ...dataAlumnos);

  await cargarCuentas();

  const resTipos = await fetch('/tipos-clase');
  tiposClase = await resTipos.json();

  // 2) Poblar selector de alumnos (+ opci√≥n PRUEBA al inicio)
  const alumnoSelect = document.getElementById("alumno-select");
  alumnoSelect.innerHTML = '';

  // Opci√≥n especial primero
  const optPrueba = new Option('000 - General - Pagos de clases de prueba', OPT_PRUEBA_VALUE, false, false);
  alumnoSelect.add(optPrueba);

  // Luego alumnos reales
  alumnos.forEach(a => {
    const option = document.createElement("option");
    option.value = a.id;
    let numeroFormateado = a.numero_alumno;
    if (a.numero_alumno < 100) {
      numeroFormateado = String(a.numero_alumno).padStart(2, '0');
    }
    option.textContent = `${numeroFormateado}-${a.sede || ''} - ${a.apellido}, ${a.nombre}`;
    alumnoSelect.appendChild(option);
  });

  // 3) Cambio de alumno => conmuta UI (normal vs prueba)
  $('#alumno-select').on('change', function () {
    const id = this.value;
    const esPrueba = (id === OPT_PRUEBA_VALUE);

    // Bloques a ocultar/mostrar
    const $mesPago     = document.getElementById('mesPago')?.parentElement;
    const $modalidad   = document.getElementById('modalidad')?.parentElement;
    const $montoStd    = document.getElementById('monto')?.parentElement;
    const $grupoManual = document.getElementById('grupoMontoManual');
    const $chkParcial  = document.getElementById('parcial');

    // Grupo especial (debe existir en el HTML, ver instrucciones previas)
    const $grupoPrueba = document.getElementById('grupoPrueba');
    if ($grupoPrueba) $grupoPrueba.style.display = esPrueba ? 'block' : 'none';

    // Campos est√°ndar
    if ($mesPago)     $mesPago.style.display     = esPrueba ? 'none' : 'block';
    if ($modalidad)   $modalidad.style.display   = esPrueba ? 'none' : 'block';
    if ($montoStd)    $montoStd.style.display    = esPrueba ? 'none' : 'block';
    if ($grupoManual) $grupoManual.style.display = esPrueba ? 'none' : ($chkParcial.checked ? 'block' : 'none');

    if ($chkParcial) {
      $chkParcial.disabled = esPrueba;
      if (esPrueba) {
        $chkParcial.checked = false;
        document.getElementById('montoParcial').value = '';
      }
    }

    if (esPrueba) {
      // Limpiar modalidad/monto si ven√≠as de un alumno normal
      document.getElementById("modalidad").value = '';
      document.getElementById("monto").value     = '';
      return;
    }

    // Alumno normal
    const alumno = alumnos.find(a => String(a.id) === String(id));
    if (!alumno) return;

    const tipo = tiposClase.find(t =>
      normalizarTexto(t.modalidad) === normalizarTexto(alumno.tipo_clase)
    );

    document.getElementById("modalidad").value = alumno.tipo_clase || '';
    document.getElementById("monto").value     = tipo?.precio || '';
  });

  // 4) Buscador
  document.getElementById('buscadorPagos').addEventListener('input', (e) => {
    renderPagos(e.target.value);
  });

  // 5) Disparar cambio y cargar pagos
  alumnoSelect.dispatchEvent(new Event('change'));
  $('#alumno-select').trigger('change.select2');
  await cargarPagos();
};

/* ====== Guardar pago ====== */
async function guardarPago() {
  const alumnoId = $('#alumno-select').val();
  const cuenta   = document.getElementById("cuenta").value;

  if (!cuenta) {
    alert("Seleccion√° la cuenta.");
    return;
  }

  // Flujo especial PRUEBA
  if (alumnoId === OPT_PRUEBA_VALUE) {
    const montoFijo  = document.getElementById('montoFijo')?.value;
    const comentario = document.getElementById('comentarioPrueba')?.value || null;
    const sede       = document.getElementById('sedePrueba')?.value;

    if (!montoFijo || isNaN(montoFijo) || parseFloat(montoFijo) <= 0) {
      alert("Ingres√° un monto v√°lido para el pago de prueba.");
      return;
    }

if (!sede) {
  alert("Seleccion√° la sede para el pago de prueba.");
  return;
}



    try {
      const res = await fetch('/pagos/prueba', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    comentario,
    monto: parseFloat(montoFijo),
    cuenta,
    sede
  })
});
      if (res.ok) {
        alert("Pago de prueba registrado con √©xito.");
        await cargarPagos();
        cerrarFormularioPago();
      } else {
        alert("Error al registrar el pago de prueba.");
      }
    } catch (e) {
      console.error(e);
      alert("Ocurri√≥ un error al registrar el pago de prueba.");
    }
    return;
  }

  // Flujo alumno normal
  const mes = document.getElementById("mesPago").value;
  let monto = '';
  if (document.getElementById("parcial").checked) {
    monto = document.getElementById("montoParcial").value;
    if (!monto || isNaN(monto) || parseFloat(monto) <= 0) {
      alert("Ingres√° un monto parcial v√°lido.");
      return;
    }
  } else {
    monto = document.getElementById("monto").value;
  }

  if (!alumnoId || !mes || !monto) {
    alert("Faltan datos obligatorios.");
    return;
  }

  try {
    const res = await fetch('/pagos', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        alumno_id: alumnoId,
        mes_pagado: mes,
        monto: parseFloat(monto),
        cuenta
      })
    });

    if (res.ok) {
      alert("Pago registrado con √©xito.");
      await cargarPagos();
      cerrarFormularioPago();
    } else if (res.status === 409) {
      alert("Ya existe un pago registrado para ese alumno en ese mes.");
    } else {
      alert("Error al registrar el pago.");
    }
  } catch (error) {
    console.error("Error en la solicitud:", error);
    alert("Ocurri√≥ un error al intentar registrar el pago.");
  }
}

/* ====== Listado / Render ====== */
async function cargarPagos() {
  // Traer pagos normales + pagos de prueba
  const [resPagos, resPrueba] = await Promise.all([
    fetch('/pagos'),
    fetch('/pagos/prueba')
  ]);

  const pagos = await resPagos.json();
  const pagosPrueba = await resPrueba.json();

  /// mappedPrueba (sumar __sede)
const mappedPrueba = (pagosPrueba || []).map(p => ({
  id        : p.id,
  alumno_id : OPT_PRUEBA_VALUE,
  mes_pagado: '-',
  monto     : p.monto,
  cuenta    : p.cuenta,
  fecha_pago: p.fecha_pago,
  __tipo    : 'prueba',
  __comentario: p.comentario || '',
  __sede    : p.sede || 'General'
}));


  pagosGlobal = [...pagos, ...mappedPrueba];
  const q = document.getElementById('buscadorPagos')?.value || '';
  renderPagos(q);
}

function renderPagos(query = '') {
  const tbody = document.getElementById("tbodyPagos");
  tbody.innerHTML = '';

  const term = normalizarTexto(query);

  // filtrar y ordenar (PRUEBA se ordena como nro=0)
  const pagos = pagosGlobal
    .filter(p => {
      if (p.alumno_id === OPT_PRUEBA_VALUE) {
        if (!term) return true;
        const label = normalizarTexto('000 pagos de clases de prueba general');
        return label.includes(term);
      }
      const a = alumnos.find(x => x.id === p.alumno_id);
      if (!a) return false;
      if (!term) return true;
      const nro = String(a.numero_alumno || '');
      const ape = normalizarTexto(a.apellido || '');
      const nom = normalizarTexto(a.nombre || '');
      return nro.includes(term) || ape.includes(term) || nom.includes(term) ||
             normalizarTexto(`${ape} ${nom}`).includes(term);
    })
    .sort((p1, p2) => {
      const getNum = (p) => p.alumno_id === OPT_PRUEBA_VALUE
        ? 0
        : (alumnos.find(x => x.id === p.alumno_id)?.numero_alumno || 0);
      return getNum(p1) - getNum(p2);
    });

  // Agrupar por sede y alumno
  const pagosPorSede = {};
  pagos.forEach(p => {
    let sede = 'Sin Sede';
    let alumnoLabel = '';

    if (p.alumno_id === OPT_PRUEBA_VALUE) {
  sede = p.__sede || 'General';               // << antes era 'General' fijo
  alumnoLabel = '000 - Pagos de clases de prueba';
} else {
      const a = alumnos.find(al => al.id === p.alumno_id);
      if (!a) return;
      sede = a.sede || 'Sin Sede';
      alumnoLabel = `${a.numero_alumno} - ${a.apellido}, ${a.nombre}`;
    }

    if (!pagosPorSede[sede]) pagosPorSede[sede] = {};
    if (!pagosPorSede[sede][alumnoLabel]) pagosPorSede[sede][alumnoLabel] = [];
    pagosPorSede[sede][alumnoLabel].push(p);
  });

  let sedeIndex = 0;
  for (const sede in pagosPorSede) {
    const sedeId = `sede-${sedeIndex++}`;
    const filaSede = document.createElement("tr");
    filaSede.style.cursor = "pointer";
    filaSede.style.backgroundColor = "#d1bfc5";
    filaSede.style.fontWeight = "bold";
    filaSede.innerHTML = `<td colspan="7" onclick="toggleSede('${sedeId}')">üßò‚Äç‚ôÄÔ∏è ${sede}</td>`;
    tbody.appendChild(filaSede);

    let grupoIndex = 0;
    for (const alumnoNombre in pagosPorSede[sede]) {
      const grupoId = `${sedeId}-grupo-${grupoIndex++}`;

      const filaTitulo = document.createElement("tr");
      filaTitulo.style.cursor = "pointer";
      filaTitulo.style.backgroundColor = "#f3d6dd";
      filaTitulo.style.fontWeight = "bold";
      filaTitulo.classList.add(sedeId);
      filaTitulo.style.display = 'none';
      filaTitulo.innerHTML = `<td colspan="7" onclick="toggleGrupo('${grupoId}')">‚ñ∂Ô∏è ${alumnoNombre}</td>`;
      tbody.appendChild(filaTitulo);

      pagosPorSede[sede][alumnoNombre].forEach(p => {
        const tr = document.createElement("tr");
        tr.classList.add(grupoId, sedeId);
        tr.style.display = 'none';

        if (p.alumno_id === OPT_PRUEBA_VALUE) {
          tr.innerHTML = `
            <td>000</td>
            <td>Pagos de prueba</td>
            <td>Prueba ${p.__comentario ? `- ${p.__comentario}` : ''}</td>
            <td>-</td>
            <td>$${parseFloat(p.monto).toFixed(2)}</td>
            <td>
              ${new Date(p.fecha_pago).toLocaleDateString('es-AR')}
              <button onclick="eliminarPagoPrueba(${p.id})" style="margin-left:10px;background:transparent;border:none;cursor:pointer;">üóëÔ∏è</button>
            </td>
            <td>${p.cuenta || '-'}</td>
          `;
        } else {
          const a = alumnos.find(x => x.id === p.alumno_id);
          const [anio, mes] = String(p.mes_pagado || '').split('-');
          const mesFormateado = (anio && mes) ? `${mes}/${anio}` : '-';
          const tipo = tiposClase.find(t =>
            normalizarTexto(t.modalidad) === normalizarTexto(a?.tipo_clase)
          );
          tr.innerHTML = `
            <td>${a?.numero_alumno ?? '-'}</td>
            <td>${a?.nombre ?? ''} ${a?.apellido ?? ''}</td>
            <td>${tipo?.modalidad || a?.tipo_clase || '-'}</td>
            <td>${mesFormateado}</td>
            <td>$${parseFloat(p.monto).toFixed(2)}</td>
            <td>
              ${new Date(p.fecha_pago).toLocaleDateString('es-AR')}
              <button onclick="eliminarPago(${p.id})" style="margin-left:10px;background:transparent;border:none;cursor:pointer;">üóëÔ∏è</button>
            </td>
            <td>${p.cuenta || '-'}</td>
          `;
        }
        tbody.appendChild(tr);
      });
    }
  }
}

/* ====== Helpers de UI ====== */
function toggleGrupo(grupoId) {
  const filas = document.querySelectorAll(`.${grupoId}`);
  filas.forEach(f => {
    f.style.display = (f.style.display === 'none') ? '' : 'none';
  });
}

function toggleSede(sedeId) {
  const filas = document.querySelectorAll(`.${sedeId}`);
  filas.forEach(f => {
    f.style.display = (f.style.display === 'none') ? '' : 'none';
  });
}

function mostrarFormularioPago() {
  const form = document.getElementById("formularioPago");
  form.style.display = form.style.display === "none" ? "block" : "none";
}

function cerrarFormularioPago() {
  document.getElementById("formularioPago").style.display = "none";
}

function toggleMenu() {
  const sidebar = document.querySelector('.sidebar');
  sidebar.classList.toggle('mostrar');
}

function cerrarSesion() {
  localStorage.removeItem('etnya_login');
  window.location.href = 'login.html';
}

/* ====== Borrados ====== */
async function eliminarPago(id) {
  if (!confirm("¬øEst√°s seguro de que quer√©s eliminar este pago?")) return;
  const res = await fetch(`/pagos/${id}`, { method: 'DELETE' });
  if (res.ok) {
    alert("Pago eliminado correctamente.");
    await cargarPagos();
  } else {
    alert("Error al eliminar el pago.");
  }
}

async function eliminarPagoPrueba(id) {
  if (!confirm("¬øEliminar este pago de prueba?")) return;
  const res = await fetch(`/pagos/prueba/${id}`, { method: 'DELETE' });
  if (res.ok) {
    alert("Pago de prueba eliminado.");
    await cargarPagos();
  } else {
    alert("Error al eliminar el pago de prueba.");
  }
}



async function eliminarPagoPrueba(id) {
  if (!confirm("¬øEliminar este pago de prueba?")) return;
  const res = await fetch(`/pagos/prueba/${id}`, { method: 'DELETE' });
  if (res.ok) {
    alert("Pago de prueba eliminado.");
    await cargarPagos();
  } else {
    alert("Error al eliminar el pago de prueba.");
  }
}


async function cargarCuentas() {
  try {
    const res = await fetch('/cuentas');
    const cuentas = await res.json();
    const select = document.getElementById('cuenta');
    select.innerHTML = '<option value="">Seleccionar cuenta</option>';

    cuentas.forEach(c => {
      const option = document.createElement('option');
      option.value = c.nombre;
      option.textContent = c.nombre;
      select.appendChild(option);
    });
  } catch (err) {
    console.error('Error al cargar cuentas:', err);
  }
}
function mostrarFormularioPago() {
  const form = document.getElementById("formularioPago");
  form.style.display = form.style.display === "none" ? "block" : "none";
}

function toggleMenu() {
  const sidebar = document.querySelector('.sidebar');
  sidebar.classList.toggle('mostrar');
}

function cerrarFormularioPago() {
  document.getElementById("formularioPago").style.display = "none";
}

function toggleSede(sedeId) {
  const filas = document.querySelectorAll(`.${sedeId}`);
  filas.forEach(f => {
    f.style.display = (f.style.display === 'none') ? '' : 'none';
  });
}



</script>

</body>
</html>
