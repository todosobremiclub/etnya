<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Configuraci√≥n</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
 <style>
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background-color: #cce1d6;
    color: #6d6d6d;
  }

  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 200px;
    height: 100vh;
    background-color: #91586d;
    padding-top: 60px;
    box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    z-index: 1000;
  }

  .sidebar a {
    display: block;
    padding: 10px 16px;
    color: white;
    text-decoration: none;
    font-weight: bold;
    border-bottom: 1px solid rgba(255,255,255,0.1);
    font-size: 13px;
  }

  .sidebar a:hover {
    background-color: #6d3e4e;
  }

  main {
    margin-left: 200px;
    padding: 16px;
  }

  .header {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
    margin-bottom: 20px;
  }

  .header img {
    height: 40px;
  }

  h1, h2 {
    color: #91586d;
    margin: 0 0 12px;
    text-align: center;
    font-size: 20px;
  }

  form {
    display: grid;
    grid-template-columns: 2fr 1fr auto;
    gap: 8px;
    background-color: white;
    padding: 12px;
    border-radius: 10px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.05);
    max-width: 700px;
    margin: 0 auto 16px;
  }

  input {
    padding: 6px 8px;
    border: 1px solid #94b8a3;
    border-radius: 4px;
    font-size: 13px;
    background-color: #f9f9f9;
    height: 30px;
  }

  button {
    background-color: #b48a99;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
    height: 30px;
  }

  button:hover {
    background-color: #91586d;
  }

  table {
    width: 100%;
    max-width: 700px;
    margin: auto;
    background-color: white;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 1px 6px rgba(0,0,0,0.04);
    border-collapse: collapse;
    font-size: 13px;
  }

  th, td {
    padding: 8px 10px;
    border-bottom: 1px solid #e0e0e0;
    text-align: left;
    vertical-align: top;
  }

  th {
    background-color: #b48a99;
    color: white;
    font-size: 13px;
  }

  .acciones button {
    margin-right: 4px;
    font-size: 12px;
    padding: 4px 8px;
  }

  .toggle-icon {
    cursor: pointer;
    margin-right: 4px;
    font-weight: bold;
  }

  .fila-oculta {
    display: none;
  }

  .titulo-feriados {
    margin-top: 40px;
    margin-bottom: 16px;
    text-align: center;
    color: #91586d;
    font-size: 18px;
  }

  @media (max-width: 768px) {
    form {
      grid-template-columns: 1fr;
    }

    .sidebar {
      width: 100%;
      height: auto;
      position: relative;
    }

    main {
      margin-left: 0;
      padding: 10px;
    }

    .header {
      flex-direction: column;
    }

    h1, h2 {
      font-size: 18px;
    }

    input, button {
      font-size: 13px;
    }

    th, td {
      font-size: 12px;
    }
  }

#menuToggle {
  display: none;
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 1100;
  background-color: #91586d;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 8px 12px;
  font-size: 18px;
  cursor: pointer;
}

@media (max-width: 768px) {
  #menuToggle {
    display: block;
  }

  .sidebar {
    display: none;
    width: 100%;
    height: auto;
    position: absolute;
    top: 50px;
    left: 0;
  }

  .sidebar.mostrar {
    display: block;
  }

  main {
    margin-left: 0;
    padding: 20px;
  }
}

.fila-becado {
  display: none;
}


</style>

</head>
<body>

<!-- Bot√≥n men√∫ hamburguesa -->
<button id="menuToggle" onclick="toggleMenu()">‚ò∞</button>

 <!-- Sidebar -->
  <div class="sidebar">
    <a href="index.html">üìã Alumnas/os</a>
    <a href="pagos.html">üí≥ Pagos</a>
    <a href="gastos.html">üßæ Gastos</a>
    <a href="agenda.html">üìÖ Agenda</a>
    <a href="configuracion.html">‚öôÔ∏è Configuraci√≥n</a>
    <a href="reportes.html">üìà Reportes</a>
    <button onclick="cerrarSesion()" style="width: 100%; text-align: left; padding: 10px 16px; background-color: transparent; border: none; color: white; font-weight: bold; font-size: 13px; cursor: pointer; border-top: 1px solid rgba(255,255,255,0.1);">
      üö™ Cerrar sesi√≥n
    </button>
  </div>
<main>
  <div class="header">
    <img src="logo.jpeg" alt="Logo">
    <h1>Configuraci√≥n Etnya</h1>
  </div>

  <form id="formTipoClase">
    <input type="text" name="modalidad" placeholder="Modalidad" required>
    <input type="number" name="precio" placeholder="Precio ($)" required>
    <button type="submit">Guardar</button>
  </form>

  <table>
    <thead>
      <tr>
        <th><span id="flechaToggle" class="toggle-icon" onclick="toggleFilas()">‚ñ∂</span> Modalidad</th>
        <th>Precio</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="tablaTipos"></tbody>
  </table>

<h2 class="titulo-feriados">Tipos de Gastos</h2>
<form id="formGasto">
  <input type="text" name="nombre" placeholder="Nombre del gasto" required>
  <button type="submit">Guardar</button>
</form>
<table>
  <thead>
    <tr>
      <th><span id="flechaGastos" class="toggle-icon" onclick="toggleGastos()">‚ñ∂</span> Nombre</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody id="tbodyGastos"></tbody>
</table>


  <h2 class="titulo-feriados">Feriados</h2>
  <form id="formFeriado">
    <input type="date" name="fecha" required>
    <input type="text" name="descripcion" placeholder="Descripci√≥n del feriado" required>
    <button type="submit">Guardar</button>
  </form>

  <table>
    <thead>
      <tr>
        <th><span id="flechaFeriados" class="toggle-icon" onclick="toggleFeriados()">‚ñ∂</span> Fecha</th>
        <th>Descripci√≥n</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="tablaFeriados"></tbody>
  </table>

<h2 class="titulo-feriados">Cuentas</h2>
<form onsubmit="guardarCuenta(); return false;">
  <input type="text" id="nuevaCuenta" placeholder="Nombre de la cuenta" required>
  <button type="submit">Guardar</button>
</form>

<table>
  <thead>
    <tr>
      <th><span id="flechaCuentas" class="toggle-icon" onclick="toggleCuentas()">‚ñ∂</span> Cuenta</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody id="tbodyCuentas"></tbody>
</table>

<h2 style="margin-top:18px;">Bloques sin clase (por sede/d√≠a/hora)</h2>
<div style="display:flex; gap:8px; flex-wrap:wrap; align-items:end; margin-bottom:8px;">
  <div>
    <label>Sede</label>
    <select id="ncSede">
      <option>Craig Reformer</option>
      <option>Craig Circuito</option>
      <option>Pedro Goyena</option>
    </select>
  </div>
  <div>
    <label>D√≠a semana</label>
    <select id="ncDow">
      <option value="1">Lunes</option>
      <option value="2">Martes</option>
      <option value="3">Mi√©rcoles</option>
      <option value="4">Jueves</option>
      <option value="5">Viernes</option>
      <option value="6">S√°bado</option>
      <option value="7">Domingo</option>
    </select>
  </div>
  <div>
    <label>Hora</label>
    <input type="time" id="ncHora">
  </div>
  <button id="btnNcGuardar">Guardar</button>
</div>

<table id="tablaNoClases" style="width:100%; border-collapse:collapse;">
  <thead>
    <tr style="background:#b48a99; color:#fff;">
      <th style="padding:6px; text-align:left;">Sede</th>
      <th style="padding:6px; text-align:left;">D√≠a</th>
      <th style="padding:6px; text-align:left;">Hora</th>
      <th style="padding:6px;">Acciones</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2 class="titulo-feriados">Becados</h2>

<form onsubmit="agregarBecado(); return false;" style="max-width: 700px; margin: 10px auto; display: flex; gap: 10px;">
  <select id="selectBecado" required style="flex: 1; padding: 6px;">
    <option value="">Seleccionar alumna/o...</option>
  </select>
  <button type="submit">Guardar</button>
</form>

<table>
  <thead>
    <tr>
      <th>
        <span id="flechaBecados" class="toggle-icon" onclick="toggleBecados()">‚ñ∂</span>
        Alumnas/os Becados
      </th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody id="tbodyBecados"></tbody>

</table>

</main>

<script>
// ------------------- MODALIDADES -------------------
let editandoId = null;
let filasVisibles = false;

async function cargarTiposClase() {
  const res = await fetch('/tipos-clase');
  const tipos = await res.json();
  const tbody = document.getElementById('tablaTipos');
  tbody.innerHTML = '';
  tipos.forEach(t => {
    const tr = document.createElement('tr');
    tr.classList.add('fila-tipo');
    if (!filasVisibles) tr.classList.add('fila-oculta');
    tr.innerHTML = `
      <td>${t.modalidad}</td>
      <td>$${Number(t.precio).toLocaleString('es-AR')}</td>
      <td class="acciones">
        <button onclick="editarTipo(${t.id}, '${t.modalidad}', ${t.precio})">‚úèÔ∏è</button>
        <button onclick="eliminarTipo(${t.id})">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function toggleFilas() {
  filasVisibles = !filasVisibles;
  const icono = document.getElementById('flechaToggle');
  icono.textContent = filasVisibles ? '‚ñº' : '‚ñ∂';
  const filas = document.querySelectorAll('.fila-tipo');
  filas.forEach(f => f.classList.toggle('fila-oculta', !filasVisibles));
}

function editarTipo(id, modalidad, precio) {
  const form = document.getElementById('formTipoClase');
  form.modalidad.value = modalidad;
  form.precio.value = precio;
  editandoId = id;
  form.querySelector('button[type="submit"]').textContent = "Actualizar";
}

document.getElementById('formTipoClase').addEventListener('submit', async function(e) {
  e.preventDefault();
  const form = e.target;
  const datos = { modalidad: form.modalidad.value, precio: form.precio.value };
  const res = await fetch(`/tipos-clase${editandoId ? '/' + editandoId : ''}`, {
    method: editandoId ? 'PUT' : 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(datos)
  });
  if (res.ok) {
    form.reset();
    editandoId = null;
    form.querySelector('button[type="submit"]').textContent = "Guardar";
    cargarTiposClase();
  } else {
    alert('Error al guardar tipo de clase');
  }
});

async function eliminarTipo(id) {
  if (!confirm('¬øEliminar este tipo?')) return;
  const res = await fetch(`/tipos-clase/${id}`, { method: 'DELETE' });
  if (res.ok) cargarTiposClase();
  else alert('Error al eliminar');
}

// ------------------- FERIADOS -------------------
let editandoFeriadoId = null;
let feriadosVisibles = false;

function formatFecha(fechaStr) {
  const clean = fechaStr.slice(0, 10);
  const [year, month, day] = clean.split('-');
  return `${day}/${month}/${year}`;
}

async function cargarFeriados() {
  const res = await fetch('/feriados');
  const feriados = await res.json();
  const tbody = document.getElementById('tablaFeriados');
  tbody.innerHTML = '';
  feriados.forEach(f => {
    const tr = document.createElement('tr');
    tr.classList.add('fila-feriado');
    if (!feriadosVisibles) tr.classList.add('fila-oculta');
    tr.innerHTML = `
      <td>${formatFecha(f.fecha)}</td>
      <td>${(f.descripcion || '').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</td>
      <td class="acciones">
        <button onclick="editarFeriado(${f.id}, '${f.fecha}', \`${(f.descripcion || '').replace(/`/g,'\\`')}\`)">‚úèÔ∏è</button>
        <button onclick="eliminarFeriado(${f.id})">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function toggleFeriados() {
  feriadosVisibles = !feriadosVisibles;
  const icono = document.getElementById('flechaFeriados');
  icono.textContent = feriadosVisibles ? '‚ñº' : '‚ñ∂';
  const filas = document.querySelectorAll('.fila-feriado');
  filas.forEach(f => f.classList.toggle('fila-oculta', !feriadosVisibles));
}

function editarFeriado(id, fecha, descripcion) {
  const form = document.getElementById('formFeriado');
  form.fecha.value = fecha;
  form.descripcion.value = descripcion;
  editandoFeriadoId = id;
  form.querySelector('button[type="submit"]').textContent = "Actualizar";
}

document.getElementById('formFeriado').addEventListener('submit', async function(e) {
  e.preventDefault();
  const form = e.target;
  const datos = {
    fecha: form.fecha.value,
    descripcion: form.descripcion.value
  };

  const res = await fetch(`/feriados${editandoFeriadoId ? '/' + editandoFeriadoId : ''}`, {
    method: editandoFeriadoId ? 'PUT' : 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(datos)
  });

  if (res.ok) {
    form.reset();
    editandoFeriadoId = null;
    form.querySelector('button[type="submit"]').textContent = "Guardar";
    cargarFeriados();
  } else {
    alert('Error al guardar feriado');
  }
});

async function eliminarFeriado(id) {
  if (!confirm('¬øEliminar este feriado?')) return;
  const res = await fetch(`/feriados/${id}`, { method: 'DELETE' });
  if (res.ok) cargarFeriados();
  else alert('Error al eliminar');
}

// ------------------- CUENTAS -------------------
let listaAlumnosBecado = [];
let cuentasVisibles = false;

function toggleCuentas() {
  cuentasVisibles = !cuentasVisibles;
  const icono = document.getElementById('flechaCuentas');
  icono.textContent = cuentasVisibles ? '‚ñº' : '‚ñ∂';
  const filas = document.querySelectorAll('.fila-cuenta');
  filas.forEach(f => f.classList.toggle('fila-oculta', !cuentasVisibles));
}

async function cargarCuentas() {
  const res = await fetch('/cuentas');
  const cuentas = await res.json();
  const tbody = document.getElementById("tbodyCuentas");
  tbody.innerHTML = '';

  cuentas.forEach(c => {
    const tr = document.createElement("tr");
    tr.classList.add("fila-cuenta");
    if (!cuentasVisibles) tr.classList.add("fila-oculta");
    tr.innerHTML = `
      <td>${(c.nombre || '').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</td>
      <td><button onclick="eliminarCuenta(${c.id})">üóëÔ∏è</button></td>
    `;
    tbody.appendChild(tr);
  });
}

async function guardarCuenta() {
  const nombre = document.getElementById("nuevaCuenta").value.trim();
  if (!nombre) {
    alert("Ingres√° un nombre de cuenta.");
    return;
  }

  const res = await fetch('/cuentas', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ nombre })
  });

  if (res.ok) {
    document.getElementById("nuevaCuenta").value = '';
    await cargarCuentas();
  } else {
    alert("Error al guardar la cuenta.");
  }
}

async function eliminarCuenta(id) {
  if (!confirm("¬øEliminar esta cuenta?")) return;
  const res = await fetch(`/cuentas/${id}`, { method: 'DELETE' });
  if (res.ok) await cargarCuentas();
  else alert("Error al eliminar.");
}

function toggleMenu() {
  const sidebar = document.querySelector('.sidebar');
  sidebar.classList.toggle('mostrar');
}

// ------------------- BECADOS -------------------
async function cargarAlumnosParaBecado() {
  const res = await fetch('/alumnos');
  const alumnos = await res.json();
  listaAlumnosBecado = alumnos;

  const select = document.getElementById('selectBecado');
  select.innerHTML = '<option value="">Seleccionar alumna/o...</option>';
  alumnos.forEach(a => {
    const option = document.createElement('option');
    option.value = a.id;
    const num = (a.numero_alumno ?? '').toString().padStart(2, '0');
    option.textContent = `${num} - ${a.apellido}, ${a.nombre}`;
    select.appendChild(option);
  });
}

function filtrarSelectBecado() {
  const texto = document.getElementById('buscarAlumnoBecado').value.toLowerCase();
  const select = document.getElementById('selectBecado');
  select.innerHTML = '<option value="">Seleccionar alumna/o...</option>';

  listaAlumnosBecado.forEach(a => {
    const num = (a.numero_alumno ?? '').toString().padStart(2, '0');
    const label = `${num} - ${a.apellido}, ${a.nombre}`;
    if (label.toLowerCase().includes(texto)) {
      const option = document.createElement('option');
      option.value = a.id;
      option.textContent = label;
      select.appendChild(option);
    }
  });
}

async function cargarBecados() {
  const res = await fetch('/becados');
  const becados = await res.json();

  const tbody = document.getElementById('tbodyBecados');
  tbody.innerHTML = '';

  becados.forEach(b => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${(b.nombre_completo || '').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</td>
      <td><button onclick="eliminarBecado(${b.id})">üóëÔ∏è</button></td>
    `;
    tr.style.display = becadosVisibles ? '' : 'none';
    tbody.appendChild(tr);
  });
}

async function agregarBecado() {
  const id = document.getElementById('selectBecado').value;
  if (!id) {
    alert('Seleccion√° un alumno');
    return;
  }

  const res = await fetch('/becados', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ alumno_id: parseInt(id) })
  });

  if (res.ok) {
    await cargarBecados();
    alert('Alumno agregado como becado');
  } else {
    alert('Error al agregar becado');
  }
}

async function eliminarBecado(id) {
  if (!confirm('¬øQuitar beca a este alumno?')) return;
  const res = await fetch(`/becados/${id}`, { method: 'DELETE' });
  if (res.ok) await cargarBecados();
  else alert('Error al eliminar becado');
}

let becadosVisibles = true;

function toggleBecados() {
  becadosVisibles = !becadosVisibles;
  document.getElementById('flechaBecados').textContent = becadosVisibles ? '‚ñº' : '‚ñ∂';
  const filas = document.querySelectorAll('#tbodyBecados tr');
  filas.forEach(el => { el.style.display = becadosVisibles ? '' : 'none'; });
}

function cerrarSesion() {
  localStorage.removeItem('etnya_login');
  window.location.href = 'login.html';
}

// ------------------- GASTOS -------------------
let gastosVisibles = false;
let editandoGastoId = null;

function toggleGastos() {
  gastosVisibles = !gastosVisibles;
  document.getElementById('flechaGastos').textContent = gastosVisibles ? '‚ñº' : '‚ñ∂';
  document.querySelectorAll('.fila-gasto').forEach(f => {
    f.classList.toggle('fila-oculta', !gastosVisibles);
  });
}

async function cargarGastos() {
  const res = await fetch('/gastos/tipos-gasto');
  const data = await res.json();
  const tbody = document.getElementById('tbodyGastos');
  tbody.innerHTML = '';

  data.forEach(g => {
    const tr = document.createElement('tr');
    tr.classList.add('fila-gasto');
    if (!gastosVisibles) tr.classList.add('fila-oculta');
    tr.innerHTML = `
      <td>${(g.nombre || '').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</td>
      <td class="acciones">
        <button onclick="editarGasto(${g.id}, '${(g.nombre || '').replace(/'/g,"\\'")}')">‚úèÔ∏è</button>
        <button onclick="eliminarGasto(${g.id})">üóëÔ∏è</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function editarGasto(id, nombre) {
  const form = document.getElementById('formGasto');
  form.nombre.value = nombre;
  editandoGastoId = id;
  form.querySelector('button[type="submit"]').textContent = "Actualizar";
}

document.getElementById('formGasto').addEventListener('submit', async function(e) {
  e.preventDefault();
  const nombre = this.nombre.value.trim();
  if (!nombre) return;

  const metodo = editandoGastoId ? 'PUT' : 'POST';
  const url = editandoGastoId ? `/gastos/tipos-gasto/${editandoGastoId}` : '/gastos/tipos-gasto';

  const res = await fetch(url, {
    method: metodo,
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ nombre })
  });

  if (res.ok) {
    this.reset();
    editandoGastoId = null;
    this.querySelector('button[type="submit"]').textContent = "Guardar";
    cargarGastos();
  } else {
    alert('Error al guardar el gasto');
  }
});

async function eliminarGasto(id) {
  if (!confirm('¬øEliminar este tipo de gasto?')) return;
  const res = await fetch(`/gastos/tipos-gasto/${id}`, { method: 'DELETE' });
  if (res.ok) cargarGastos();
  else alert('Error al eliminar');
}

// =================== NO CLASES (sede/d√≠a/hora) ===================
const DIAS_TXT = ['','Lunes','Martes','Mi√©rcoles','Jueves','Viernes','S√°bado','Domingo'];
let noClasesVisibles = false;
let noClasesEditandoId = null;

function toggleNoClases() {
  noClasesVisibles = !noClasesVisibles;
  const icono = document.getElementById('flechaNoClases');
  if (icono) icono.textContent = noClasesVisibles ? '‚ñº' : '‚ñ∂';
  document.querySelectorAll('.fila-noclase').forEach(f => {
    f.classList.toggle('fila-oculta', !noClasesVisibles);
  });
}

async function cargarNoClasesCfg(){
  const res = await fetch('/no-clases');
  const rows = await res.json();
  const tb = document.querySelector('#tablaNoClases tbody');
  if (!tb) return;
  tb.innerHTML = '';
  rows.forEach(r => {
    const tr = document.createElement('tr');
    tr.classList.add('fila-noclase');
    if (!noClasesVisibles) tr.classList.add('fila-oculta');
    const horaTxt = (r.hora || '').slice(0,5);
    tr.innerHTML = `
      <td>${(r.sede || '').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</td>
      <td>${DIAS_TXT[Number(r.dow) || 0]}</td>
      <td>${horaTxt}</td>
      <td class="acciones" style="text-align:center;">
        <button onclick="editarNoClase(${r.id}, '${(r.sede || '').replace(/'/g,"\\'")}', ${Number(r.dow)||0}, '${horaTxt}')">‚úèÔ∏è</button>
        <button onclick="eliminarNoClase(${r.id})">üóëÔ∏è</button>
      </td>`;
    tb.appendChild(tr);
  });
}

function editarNoClase(id, sede, dow, hora){
  const selSede = document.getElementById('ncSede');
  const selDow  = document.getElementById('ncDow');
  const inpHora = document.getElementById('ncHora');
  if (!selSede || !selDow || !inpHora) return;
  selSede.value = sede;
  selDow.value  = String(dow);
  inpHora.value = hora;
  noClasesEditandoId = id;
  const btn = document.getElementById('btnNcGuardar');
  if (btn) btn.textContent = 'Actualizar';
}

async function guardarNoClase(){
  const selSede = document.getElementById('ncSede');
  const selDow  = document.getElementById('ncDow');
  const inpHora = document.getElementById('ncHora');
  if (!selSede || !selDow || !inpHora) return;

  const sede = (selSede.value || '').trim();
  const dow  = parseInt(selDow.value,10);
  const hora = (inpHora.value || '').slice(0,5);
  if (!sede || !dow || !hora){ alert('Complet√° sede, d√≠a y hora'); return; }

  const url = '/no-clases' + (noClasesEditandoId ? '/' + noClasesEditandoId : '');
  const method = noClasesEditandoId ? 'PUT' : 'POST';
  const r = await fetch(url, {
    method,
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ sede, dow, hora })
  });
  if (!r.ok){ alert('No se pudo guardar'); return; }

  // reset
  noClasesEditandoId = null;
  const btn = document.getElementById('btnNcGuardar');
  if (btn) btn.textContent = 'Guardar';
  inpHora.value = '';
  await cargarNoClasesCfg();
}

async function eliminarNoClase(id){
  if (!confirm('¬øEliminar este bloqueo?')) return;
  const r = await fetch('/no-clases/'+id, { method:'DELETE' });
  if (!r.ok){ alert('No se pudo eliminar'); return; }
  await cargarNoClasesCfg();
}

// ------------------- ONLOAD -------------------

// Guardia de login
if (localStorage.getItem('etnya_login') !== 'ok') { location = 'login.html'; }

// Timeout de sesi√≥n (6h) ‚Äî asegurate de tener session-timeout.js incluido en el HTML
// <script src="session-timeout.js"></script> (ya est√° en tu HTML)

window.addEventListener('load', () => {
  try { cargarTiposClase(); }            catch (e) { console.error(e); }
  try { cargarFeriados(); }              catch (e) { console.error(e); }
  try { cargarCuentas(); }               catch (e) { console.error(e); }
  try { cargarAlumnosParaBecado(); }     catch (e) { console.error(e); }
  try { cargarBecados(); }               catch (e) { console.error(e); }
  try { cargarGastos(); }                catch (e) { console.error(e); }
  try { cargarNoClasesCfg(); }           catch (e) { console.error(e); }

  // Ocultar tablas plegables al inicio
  window.becadosVisibles = false;
  const flechaB = document.getElementById('flechaBecados');
  if (flechaB) flechaB.textContent = '‚ñ∂';

  noClasesVisibles = false;
  const flechaNC = document.getElementById('flechaNoClases');
  if (flechaNC) flechaNC.textContent = '‚ñ∂';

  // Hook bot√≥n guardar de No Clases
  const btnNC = document.getElementById('btnNcGuardar');
  if (btnNC) btnNC.addEventListener('click', guardarNoClase);
});
</script>
</body>
</html>

